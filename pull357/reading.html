

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. Reading in data locally and from the web &#8212; Data Science: A First Introduction with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-7XBFF4RSN2"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-7XBFF4RSN2');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reading';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Cleaning and wrangling data" href="wrangling.html" />
    <link rel="prev" title="1. Python and Pandas" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Data Science: A First Introduction with Python</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Front Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="preface-text.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="foreword-text.html">Foreword</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">About the authors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Python and Pandas</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Reading in data locally and from the web</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrangling.html">3. Cleaning and wrangling data</a></li>
<li class="toctree-l1"><a class="reference internal" href="viz.html">4. Effective data visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification1.html">5. Classification I: training &amp; predicting</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification2.html">6. Classification II: evaluation &amp; tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression1.html">7. Regression I: K-nearest neighbors</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression2.html">8. Regression II: linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html">9. Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="inference.html">10. Statistical inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">11. Combining code and text with Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="version-control.html">12. Collaboration with version control</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">13. Setting up your computer</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/reading.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reading in data locally and from the web</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">2.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-learning-objectives">2.2. Chapter learning objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-and-relative-file-paths">2.3. Absolute and relative file paths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-tabular-data-from-a-plain-text-file-into-python">2.4. Reading tabular data from a plain text file into Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-csv-to-read-in-comma-separated-values-files">2.4.1. <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to read in comma-separated values files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#skipping-rows-when-reading-in-data">2.4.2. Skipping rows when reading in data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-sep-argument-for-different-separators">2.4.3. Using the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument for different separators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-header-argument-to-handle-missing-column-names">2.4.4. Using the <code class="docutils literal notranslate"><span class="pre">header</span></code> argument to handle missing column names</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-tabular-data-directly-from-a-url">2.4.5. Reading tabular data directly from a URL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#previewing-a-data-file-before-reading-it-into-python">2.4.6. Previewing a data file before reading it into Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-tabular-data-from-a-microsoft-excel-file">2.5. Reading tabular data from a Microsoft Excel file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-a-database">2.6. Reading data from a database</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-a-sqlite-database">2.6.1. Reading data from a SQLite database</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-a-postgresql-database">2.6.2. Reading data from a PostgreSQL database</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-should-we-bother-with-databases-at-all">2.6.3. Why should we bother with databases at all?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-data-from-python-to-a-csv-file">2.7. Writing data from Python to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-data-from-the-web">2.8. Obtaining data from the web</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#web-scraping">2.8.1. Web scraping</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#html-and-css-selectors">HTML and CSS selectors</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scraping-with-beautifulsoup">Scraping with <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scraping-with-read-html">Scraping with <code class="docutils literal notranslate"><span class="pre">read_html</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-an-api">2.8.2. Using an API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-nasa-api">Accessing the NASA API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">2.9. Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">2.10. Additional resources</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">2.11. References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="reading-in-data-locally-and-from-the-web">
<span id="reading"></span><h1><span class="section-number">2. </span>Reading in data locally and from the web<a class="headerlink" href="#reading-in-data-locally-and-from-the-web" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2><span class="section-number">2.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<span class="target" id="index-0"></span><p id="index-1">In this chapter, you’ll learn to read tabular data of various formats into Python
from your local device (e.g., your laptop) and the web. “Reading” (or “loading”)
is the process of
converting data (stored as plain text, a database, HTML, etc.) into an object
(e.g., a data frame) that Python can easily access and manipulate. Thus reading data
is the gateway to any data analysis; you won’t be able to analyze data unless
you’ve loaded it first. And because there are many ways to store data, there
are similarly many ways to read data into Python. The more time you spend upfront
matching the data reading method to the type of data you have, the less time
you will have to devote to re-formatting, cleaning and wrangling your data (the
second step to all data analyses). It’s like making sure your shoelaces are
tied well before going for a run so that you don’t trip later on!</p>
</section>
<section id="chapter-learning-objectives">
<h2><span class="section-number">2.2. </span>Chapter learning objectives<a class="headerlink" href="#chapter-learning-objectives" title="Permalink to this heading">#</a></h2>
<p>By the end of the chapter, readers will be able to do the following:</p>
<ul class="simple">
<li><p>Define the types of path and use them to locate files:</p>
<ul>
<li><p>absolute file path</p></li>
<li><p>relative file path</p></li>
<li><p>Uniform Resource Locator (URL)</p></li>
</ul>
</li>
<li><p>Read data into Python from various types of path using:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_excel</span></code></p></li>
</ul>
</li>
<li><p>Compare and contrast <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> and <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>.</p></li>
<li><p>Describe when to use the following <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function arguments:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">skiprows</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">names</span></code></p></li>
</ul>
</li>
<li><p>Choose the appropriate <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function arguments to load a given plain text tabular data set into Python.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">rename</span></code> function to rename columns in a data frame.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package’s <code class="docutils literal notranslate"><span class="pre">read_excel</span></code> function and arguments to load a sheet from an excel file into Python.</p></li>
<li><p>Work with databases using functions from the <code class="docutils literal notranslate"><span class="pre">ibis</span></code> package:</p>
<ul>
<li><p>Connect to a database with <code class="docutils literal notranslate"><span class="pre">connect</span></code>.</p></li>
<li><p>List tables in the database with <code class="docutils literal notranslate"><span class="pre">list_tables</span></code>.</p></li>
<li><p>Create a reference to a database table with <code class="docutils literal notranslate"><span class="pre">table</span></code>.</p></li>
<li><p>Bring data from a database into Python with <code class="docutils literal notranslate"><span class="pre">execute</span></code>.</p></li>
</ul>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">to_csv</span></code> to save a data frame to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file.</p></li>
<li><p>(<em>Optional</em>) Obtain data from the web using scraping and application programming interfaces (APIs):</p>
<ul>
<li><p>Read HTML source code from a URL using the <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> package.</p></li>
<li><p>Read data from the NASA “Astronomy Picture of the Day” using the <code class="docutils literal notranslate"><span class="pre">requests</span></code> package.</p></li>
<li><p>Compare downloading tabular data from a plain text file (e.g., <code class="docutils literal notranslate"><span class="pre">.csv</span></code>), accessing data from an API, and scraping the HTML source code from a website.</p></li>
</ul>
</li>
</ul>
</section>
<section id="absolute-and-relative-file-paths">
<h2><span class="section-number">2.3. </span>Absolute and relative file paths<a class="headerlink" href="#absolute-and-relative-file-paths" title="Permalink to this heading">#</a></h2>
<span class="target" id="index-2"></span><p id="index-3">This chapter will discuss the different functions we can use to import data
into Python, but before we can talk about <em>how</em> we read the data into Python with these
functions, we first need to talk about <em>where</em> the data lives. When you load a
data set into Python, you first need to tell Python where those files live. The file
could live on your computer (<em>local</em>) or somewhere on the internet (<em>remote</em>).</p>
<p>The place where the file lives on your computer is referred to as its “path”. You can
think of the path as directions to the file. There are two kinds of paths:
<em>relative</em> paths and <em>absolute</em> paths. A relative path indicates where the file is
with respect to your <em>working directory</em> (i.e., “where you are currently”) on the computer.
On the other hand, an absolute path indicates where the file is
with respect to the computer’s filesystem base (or <em>root</em>) folder, regardless of where you are working.</p>
<p>Suppose our computer’s filesystem looks like the picture in
<a class="reference internal" href="#filesystem"><span class="std std-numref">Fig. 2.1</span></a>. We are working in a
file titled <code class="docutils literal notranslate"><span class="pre">project3.ipynb</span></code>, and our current working directory is <code class="docutils literal notranslate"><span class="pre">project3</span></code>;
typically, as is the case here, the working directory is the directory containing the file you are currently
working on.</p>
<figure class="align-default" id="filesystem">
<img alt="_images/filesystem.png" src="_images/filesystem.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.1 </span><span class="caption-text">Example file system</span><a class="headerlink" href="#filesystem" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Let’s say we wanted to open the <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> file. We have two options to indicate
where the file is: using a relative path, or using an absolute path.
The absolute path of the file always starts with a slash <code class="docutils literal notranslate"><span class="pre">/</span></code>—representing the root folder on the computer—and
proceeds by listing out the sequence of folders you would have to enter to reach the file, each separated by another slash <code class="docutils literal notranslate"><span class="pre">/</span></code>.
So in this case, <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> would be reached by starting at the root, and entering the <code class="docutils literal notranslate"><span class="pre">home</span></code> folder,
then the <code class="docutils literal notranslate"><span class="pre">dsci-100</span></code> folder, then the <code class="docutils literal notranslate"><span class="pre">project3</span></code> folder, and then finally the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder. So its absolute
path would be <code class="docutils literal notranslate"><span class="pre">/home/dsci-100/project3/data/happiness_report.csv</span></code>. We can load the file using its absolute path
as a string passed to the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function from <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">happy_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/home/dsci-100/project3/data/happiness_report.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we instead wanted to use a relative path, we would need to list out the sequence of steps needed to get from our current
working directory to the file, with slashes <code class="docutils literal notranslate"><span class="pre">/</span></code> separating each step. Since we are currently in the <code class="docutils literal notranslate"><span class="pre">project3</span></code> folder,
we just need to enter the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder to reach our desired file. Hence the relative path is <code class="docutils literal notranslate"><span class="pre">data/happiness_report.csv</span></code>,
and we can load the file using its relative path as a string passed to <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">happy_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/happiness_report.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that there is no forward slash at the beginning of a relative path; if we accidentally typed <code class="docutils literal notranslate"><span class="pre">&quot;/data/happiness_report.csv&quot;</span></code>,
Python would look for a folder named <code class="docutils literal notranslate"><span class="pre">data</span></code> in the root folder of the computer—but that doesn’t exist!</p>
<span class="target" id="index-4"></span><span class="target" id="index-5"></span><p id="index-6">Aside from specifying places to go in a path using folder names (like <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">project3</span></code>), we can also specify two additional
special places: the <em>current directory</em> and the <em>previous directory</em>. We indicate the current working directory with a single dot <code class="docutils literal notranslate"><span class="pre">.</span></code>, and
the previous directory with two dots <code class="docutils literal notranslate"><span class="pre">..</span></code>. So for instance, if we wanted to reach the <code class="docutils literal notranslate"><span class="pre">bike_share.csv</span></code> file from the <code class="docutils literal notranslate"><span class="pre">project3</span></code> folder, we could
use the relative path <code class="docutils literal notranslate"><span class="pre">../project2/bike_share.csv</span></code>. We can even combine these two; for example, we could reach the <code class="docutils literal notranslate"><span class="pre">bike_share.csv</span></code> file using
the (very silly) path <code class="docutils literal notranslate"><span class="pre">../project2/../project2/./bike_share.csv</span></code> with quite a few redundant directions: it says to go back a folder, then open <code class="docutils literal notranslate"><span class="pre">project2</span></code>,
then go back a folder again, then open <code class="docutils literal notranslate"><span class="pre">project2</span></code> again, then stay in the current directory, then finally get to <code class="docutils literal notranslate"><span class="pre">bike_share.csv</span></code>. Whew, what a long trip!</p>
<p>So which kind of path should you use: relative, or absolute? Generally speaking, you should use relative paths.
Using a relative path helps ensure that your code can be run
on a different computer (and as an added bonus, relative paths are often shorter—easier to type!).
This is because a file’s relative path is often the same across different computers, while a
file’s absolute path (the names of
all of the folders between the computer’s root, represented by <code class="docutils literal notranslate"><span class="pre">/</span></code>, and the file) isn’t usually the same
across different computers. For example, suppose Fatima and Jayden are working on a
project together on the <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> data. Fatima’s file is stored at</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/home/Fatima/project3/data/happiness_report.csv
</pre></div>
</div>
<p>while Jayden’s is stored at</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/home/Jayden/project3/data/happiness_report.csv
</pre></div>
</div>
<p>Even though Fatima and Jayden stored their files in the same place on their
computers (in their home folders), the absolute paths are different due to
their different usernames.  If Jayden has code that loads the
<code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> data using an absolute path, the code won’t work on
Fatima’s computer.  But the relative path from inside the <code class="docutils literal notranslate"><span class="pre">project3</span></code> folder
(<code class="docutils literal notranslate"><span class="pre">data/happiness_report.csv</span></code>) is the same on both computers; any code that uses
relative paths will work on both! In the additional resources section,
we include a link to a short video on the
difference between absolute and relative paths.</p>
<p id="index-7">Beyond files stored on your computer (i.e., locally), we also need a way to locate resources
stored elsewhere on the internet (i.e., remotely). For this purpose we use a
<em>Uniform Resource Locator (URL)</em>, i.e., a web address that looks something
like <a class="reference external" href="https://python.datasciencebook.ca/">https://python.datasciencebook.ca/</a>. URLs indicate the location of a resource on the internet, and
start with a web domain, followed by a forward slash <code class="docutils literal notranslate"><span class="pre">/</span></code>, and then a path
to where the resource is located on the remote machine.</p>
</section>
<section id="reading-tabular-data-from-a-plain-text-file-into-python">
<h2><span class="section-number">2.4. </span>Reading tabular data from a plain text file into Python<a class="headerlink" href="#reading-tabular-data-from-a-plain-text-file-into-python" title="Permalink to this heading">#</a></h2>
<section id="read-csv-to-read-in-comma-separated-values-files">
<span id="readcsv"></span><h3><span class="section-number">2.4.1. </span><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to read in comma-separated values files<a class="headerlink" href="#read-csv-to-read-in-comma-separated-values-files" title="Permalink to this heading">#</a></h3>
<p id="index-8">Now that we have learned about <em>where</em> data could be, we will learn about <em>how</em>
to import data into Python using various functions. Specifically, we will learn how
to <em>read</em> tabular data from a plain text file (a document containing only text)
<em>into</em> Python and <em>write</em> tabular data to a file <em>out of</em> Python. The function we use to do this
depends on the file’s format. For example, in the last chapter, we learned about using
the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function from <code class="docutils literal notranslate"><span class="pre">pandas</span></code> when reading <code class="docutils literal notranslate"><span class="pre">.csv</span></code> (<strong>c</strong>omma-<strong>s</strong>eparated <strong>v</strong>alues)
files. In that case, the <em>separator</em> that divided our columns was a
comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>). We only learned the case where the data matched the expected defaults
of the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function
(column names are present, and commas are used as the separator between columns).
In this section, we will learn how to read
files that do not satisfy the default expectations of <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>.</p>
<p id="index-9">Before we jump into the cases where the data aren’t in the expected default format
for <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, let’s revisit the more straightforward
case where the defaults hold, and the only argument we need to give to the function
is the path to the file, <code class="docutils literal notranslate"><span class="pre">data/can_lang.csv</span></code>. The <code class="docutils literal notranslate"><span class="pre">can_lang</span></code> data set contains
language data from the 2016 Canadian census.
We put <code class="docutils literal notranslate"><span class="pre">data/</span></code> before the file’s
name when we are loading the data set because this data set is located in a
sub-folder, named <code class="docutils literal notranslate"><span class="pre">data</span></code>, relative to where we are running our Python code.
Here is what the text in the file <code class="docutils literal notranslate"><span class="pre">data/can_lang.csv</span></code> looks like.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>category,language,mother_tongue,most_at_home,most_at_work,lang_known
Aboriginal languages,&quot;Aboriginal languages, n.o.s.&quot;,590,235,30,665
Non-Official &amp; Non-Aboriginal languages,Afrikaans,10260,4785,85,23415
Non-Official &amp; Non-Aboriginal languages,&quot;Afro-Asiatic languages, n.i.e.&quot;,1150,44
Non-Official &amp; Non-Aboriginal languages,Akan (Twi),13460,5985,25,22150
Non-Official &amp; Non-Aboriginal languages,Albanian,26895,13135,345,31930
Aboriginal languages,&quot;Algonquian languages, n.i.e.&quot;,45,10,0,120
Aboriginal languages,Algonquin,1260,370,40,2480
Non-Official &amp; Non-Aboriginal languages,American Sign Language,2685,3020,1145,21
Non-Official &amp; Non-Aboriginal languages,Amharic,22465,12785,200,33670
</pre></div>
</div>
<p id="index-10">And here is a review of how we can use <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to load it into Python. First we
load the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package to gain access to useful
functions for reading the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>Next we use <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to load the data into Python, and in that call we specify the
relative path to the file.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.csv&quot;</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="skipping-rows-when-reading-in-data">
<h3><span class="section-number">2.4.2. </span>Skipping rows when reading in data<a class="headerlink" href="#skipping-rows-when-reading-in-data" title="Permalink to this heading">#</a></h3>
<p>Oftentimes, information about how data was collected, or other relevant
information, is included at the top of the data file. This information is
usually written in sentence and paragraph form, with no separator because it is
not organized into columns. An example of this is shown below. This information
gives the data scientist useful context and information about the data,
however, it is not well formatted or intended to be read into a data frame cell
along with the tabular data that follows later in the file.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Data source: https://ttimbers.github.io/canlang/
Data originally published in: Statistics Canada Census of Population 2016.
Reproduced and distributed on an as-is basis with their permission.
category,language,mother_tongue,most_at_home,most_at_work,lang_known
Aboriginal languages,&quot;Aboriginal languages, n.o.s.&quot;,590,235,30,665
Non-Official &amp; Non-Aboriginal languages,Afrikaans,10260,4785,85,23415
Non-Official &amp; Non-Aboriginal languages,&quot;Afro-Asiatic languages, n.i.e.&quot;,1150,445,10,2775
Non-Official &amp; Non-Aboriginal languages,Akan (Twi),13460,5985,25,22150
Non-Official &amp; Non-Aboriginal languages,Albanian,26895,13135,345,31930
Aboriginal languages,&quot;Algonquian languages, n.i.e.&quot;,45,10,0,120
Aboriginal languages,Algonquin,1260,370,40,2480
Non-Official &amp; Non-Aboriginal languages,American Sign Language,2685,3020,1145,21930
Non-Official &amp; Non-Aboriginal languages,Amharic,22465,12785,200,33670
</pre></div>
</div>
<p>With this extra information being present at the top of the file, using
<code class="docutils literal notranslate"><span class="pre">read_csv</span></code> as we did previously does not allow us to correctly load the data
into Python. In the case of this file, Python just prints a <code class="docutils literal notranslate"><span class="pre">ParserError</span></code>
message, indicating that it wasn’t able to read the file.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang_meta-data.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ParserError: Error tokenizing data. C error: Expected 1 fields in line 4, saw 6
</pre></div>
</div>
</div>
</div>
<span class="target" id="index-11"></span><p id="index-12">To successfully read data like this into Python, the <code class="docutils literal notranslate"><span class="pre">skiprows</span></code>
argument can be useful to tell Python
how many rows to skip before
it should start reading in the data. In the example above, we would set this
value to 3 to read and load the data correctly.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang_meta-data.csv&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>How did we know to skip three rows? We looked at the data! The first three rows
of the data had information we didn’t need to import:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Data source: https://ttimbers.github.io/canlang/
Data originally published in: Statistics Canada Census of Population 2016.
Reproduced and distributed on an as-is basis with their permission.
</pre></div>
</div>
<p>The column names began at row 4, so we skipped the first three rows.</p>
</section>
<section id="using-the-sep-argument-for-different-separators">
<h3><span class="section-number">2.4.3. </span>Using the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument for different separators<a class="headerlink" href="#using-the-sep-argument-for-different-separators" title="Permalink to this heading">#</a></h3>
<p>Another common way data is stored is with tabs as the separator. Notice the
data file, <code class="docutils literal notranslate"><span class="pre">can_lang.tsv</span></code>, has tabs in between the columns instead of
commas.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>category	language	mother_tongue	most_at_home	most_at_work	lang_known
Aboriginal languages	Aboriginal languages, n.o.s.	590	235	30	665
Non-Official &amp; Non-Aboriginal languages	Afrikaans	10260	4785	85	23415
Non-Official &amp; Non-Aboriginal languages	Afro-Asiatic languages, n.i.e.	1150	445	10	2775
Non-Official &amp; Non-Aboriginal languages	Akan (Twi)	13460	5985	25	22150
Non-Official &amp; Non-Aboriginal languages	Albanian	26895	13135	345	31930
Aboriginal languages	Algonquian languages, n.i.e.	45	10	0	120
Aboriginal languages	Algonquin	1260	370	40	2480
Non-Official &amp; Non-Aboriginal languages	American Sign Language	2685	3020	1145	21930
Non-Official &amp; Non-Aboriginal languages	Amharic	22465	12785	200	33670
</pre></div>
</div>
<span class="target" id="index-13"></span><span class="target" id="index-14"></span><p id="index-15">To read in <code class="docutils literal notranslate"><span class="pre">.tsv</span></code> (<strong>t</strong>ab <strong>s</strong>eparated <strong>v</strong>alues) files, we can set the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument
in the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function to the <em>tab character</em> <code class="docutils literal notranslate"><span class="pre">\t</span></code>.</p>
<div class="admonition note" id="index-16">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">\t</span></code> is an example of an <em>escaped character</em>,
which always starts with a backslash (<code class="docutils literal notranslate"><span class="pre">\</span></code>).
Escaped characters are used to represent non-printing characters
(like the tab) or characters with special meanings (such as quotation marks).</p>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>If you compare the data frame here to the data frame we obtained in
<a class="reference internal" href="#readcsv"><span class="std std-numref">Section 2.4.1</span></a> using <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, you’ll notice that they look identical: they have
the same number of columns and rows, the same column names, and the same entries!
So even though we needed to use different
arguments depending on the file format, our resulting data frame
(<code class="docutils literal notranslate"><span class="pre">canlang_data</span></code>) in both cases was the same.</p>
</section>
<section id="using-the-header-argument-to-handle-missing-column-names">
<h3><span class="section-number">2.4.4. </span>Using the <code class="docutils literal notranslate"><span class="pre">header</span></code> argument to handle missing column names<a class="headerlink" href="#using-the-header-argument-to-handle-missing-column-names" title="Permalink to this heading">#</a></h3>
<p id="index-17">The <code class="docutils literal notranslate"><span class="pre">can_lang_no_names.tsv</span></code> file contains a slightly different version
of this data set, except with no column names, and tabs for separators.
Here is how the file looks in a text editor:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Aboriginal languages	Aboriginal languages, n.o.s.	590	235	30	665
Non-Official &amp; Non-Aboriginal languages	Afrikaans	10260	4785	85	23415
Non-Official &amp; Non-Aboriginal languages	Afro-Asiatic languages, n.i.e.	1150	445	10	2775
Non-Official &amp; Non-Aboriginal languages	Akan (Twi)	13460	5985	25	22150
Non-Official &amp; Non-Aboriginal languages	Albanian	26895	13135	345	31930
Aboriginal languages	Algonquian languages, n.i.e.	45	10	0	120
Aboriginal languages	Algonquin	1260	370	40	2480
Non-Official &amp; Non-Aboriginal languages	American Sign Language	2685	3020	1145	21930
Non-Official &amp; Non-Aboriginal languages	Amharic	22465	12785	200	33670
</pre></div>
</div>
<p>Data frames in Python need to have column names.  Thus if you read in data
without column names, Python will assign names automatically. In this example,
Python assigns the column names <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5</span></code>.
To read this data into Python, we specify the first
argument as the path to the file (as done with <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>), and then provide
values to the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument (here a tab, which we represent by <code class="docutils literal notranslate"><span class="pre">&quot;\t&quot;</span></code>),
and finally set <code class="docutils literal notranslate"><span class="pre">header</span> <span class="pre">=</span> <span class="pre">None</span></code> to tell <code class="docutils literal notranslate"><span class="pre">pandas</span></code> that the data file does not
contain its own column names.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;data/can_lang_no_names.tsv&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p id="index-18">It is best to rename your columns manually in this scenario. The current column names
(<code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1</span></code>, etc.) are problematic for two reasons: first, because they not very descriptive names, which will make your analysis
confusing; and second, because your column names should generally be <em>strings</em>, but are currently <em>integers</em>.
To rename your columns, you can use the <code class="docutils literal notranslate"><span class="pre">rename</span></code> function
from the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html#">pandas package</a>.
The argument of the <code class="docutils literal notranslate"><span class="pre">rename</span></code> function is <code class="docutils literal notranslate"><span class="pre">columns</span></code>, which takes a mapping between the old column names and the new column names.
In this case, we want to rename the old columns (<code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">...,</span> <span class="pre">5</span></code>) in the <code class="docutils literal notranslate"><span class="pre">canlang_data</span></code> data frame to more descriptive names.</p>
<p>To specify the mapping, we create a <em>dictionary</em>: a Python object that represents
a mapping from <em>keys</em> to <em>values</em>. We can create a dictionary by using a pair of curly
braces <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code>, and inside the braces placing pairs of <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">:</span> <span class="pre">value</span></code> separated by commas.
Below, we create a dictionary called <code class="docutils literal notranslate"><span class="pre">col_map</span></code> that maps the old column names in <code class="docutils literal notranslate"><span class="pre">canlang_data</span></code> to new column
names, and then pass it to the <code class="docutils literal notranslate"><span class="pre">rename</span></code> function.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span> <span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
    <span class="mi">1</span> <span class="p">:</span> <span class="s2">&quot;language&quot;</span><span class="p">,</span>
    <span class="mi">2</span> <span class="p">:</span> <span class="s2">&quot;mother_tongue&quot;</span><span class="p">,</span>
    <span class="mi">3</span> <span class="p">:</span> <span class="s2">&quot;most_at_home&quot;</span><span class="p">,</span>
    <span class="mi">4</span> <span class="p">:</span> <span class="s2">&quot;most_at_work&quot;</span><span class="p">,</span>
    <span class="mi">5</span> <span class="p">:</span> <span class="s2">&quot;lang_known&quot;</span>
<span class="p">}</span>
<span class="n">canlang_data_renamed</span> <span class="o">=</span> <span class="n">canlang_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_map</span><span class="p">)</span>
<span class="n">canlang_data_renamed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p id="index-19">The column names can also be assigned to the data frame immediately upon reading it from the file by passing a
list of column names to the <code class="docutils literal notranslate"><span class="pre">names</span></code> argument in <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;data/can_lang_no_names.tsv&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;language&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mother_tongue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;most_at_home&quot;</span><span class="p">,</span>
        <span class="s2">&quot;most_at_work&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lang_known&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="reading-tabular-data-directly-from-a-url">
<h3><span class="section-number">2.4.5. </span>Reading tabular data directly from a URL<a class="headerlink" href="#reading-tabular-data-directly-from-a-url" title="Permalink to this heading">#</a></h3>
<p id="index-20">We can also use <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to read in data directly from a <strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator (URL) that
contains tabular data. Here, we provide the URL of a remote file
to <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, instead of a path to a local file on our
computer. We need to surround the URL with quotes similar to when we specify a
path on our local computer. All other arguments that we use are the same as
when using these functions with a local file on our computer.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/UBC-DSCI/introduction-to-datascience-python/reading/source/data/can_lang.csv&quot;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="previewing-a-data-file-before-reading-it-into-python">
<h3><span class="section-number">2.4.6. </span>Previewing a data file before reading it into Python<a class="headerlink" href="#previewing-a-data-file-before-reading-it-into-python" title="Permalink to this heading">#</a></h3>
<p>In many of the examples above, we gave you previews of the data file before we read
it into Python. Previewing data is essential to see whether or not there are column
names, what the separators are, and if there are rows you need to skip. You
should do this yourself when trying to read in data files: open the file in whichever
text editor you prefer to inspect its contents prior to reading it into Python.</p>
</section>
</section>
<section id="reading-tabular-data-from-a-microsoft-excel-file">
<h2><span class="section-number">2.5. </span>Reading tabular data from a Microsoft Excel file<a class="headerlink" href="#reading-tabular-data-from-a-microsoft-excel-file" title="Permalink to this heading">#</a></h2>
<span class="target" id="index-21"></span><span class="target" id="index-22"></span><p id="index-23">There are many other ways to store tabular data sets beyond plain text files,
and similarly, many ways to load those data sets into Python. For example, it is
very common to encounter, and need to load into Python, data stored as a Microsoft
Excel spreadsheet (with the file name
extension <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>).  To be able to do this, a key thing to know is that even
though <code class="docutils literal notranslate"><span class="pre">.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> files look almost identical when loaded into Excel,
the data themselves are stored completely differently.  While <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files are
plain text files, where the characters you see when you open the file in a text
editor are exactly the data they represent, this is not the case for <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>
files. Take a look at a snippet of what a <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> file would look like in a text editor:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>,?&#39;O
    _rels/.rels???J1??&gt;E?{7?
&lt;?V????w8?&#39;J???&#39;QrJ???Tf?d??d?o?wZ&#39;???@&gt;?4&#39;?|??hlIo??F
t                                                       8f??3wn
????t??u&quot;/
          %~Ed2??&lt;?w??
                       ?Pd(??J-?E???7?&#39;t(?-GZ?????y???c~N?g[^_r?4
                                                                  yG?O
                                                                      ?K??G?


     ]TUEe??O??c[???????6q??s??d?m???\???H?^????3} ?rZY? ?:L60?^?????XTP+?|?
X?a??4VT?,D?Jq
</pre></div>
</div>
<span class="target" id="index-24"></span><p id="index-25">This type of file representation allows Excel files to store additional things
that you cannot store in a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file, such as fonts, text formatting,
graphics, multiple sheets and more. And despite looking odd in a plain text
editor, we can read Excel spreadsheets into Python using the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package’s <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>
function developed specifically for this
purpose.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;data/can_lang.xlsx&quot;</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> file has multiple sheets, you have to use the <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code> argument
to specify the sheet number or name. This functionality is useful when a single sheet contains
multiple tables (a sad thing that happens to many Excel spreadsheets since this
makes reading in data more difficult). You can also specify cell ranges using the
<code class="docutils literal notranslate"><span class="pre">usecols</span></code> argument (e.g., <code class="docutils literal notranslate"><span class="pre">usecols=&quot;A:D&quot;</span></code> for including columns from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">D</span></code>).</p>
<p>As with plain text files, you should always explore the data file before
importing it into Python. Exploring the data beforehand helps you decide which
arguments you need to load the data into Python successfully. If you do not have
the Excel program on your computer, you can use other programs to preview the
file. Examples include Google Sheets and Libre Office.</p>
<p>In <a class="reference internal" href="#read-func"><span class="std std-numref">Table 2.1</span></a> we summarize the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> and <code class="docutils literal notranslate"><span class="pre">read_excel</span></code> functions we covered
in this chapter. We also include the arguments for data separated by
semicolons <code class="docutils literal notranslate"><span class="pre">;</span></code>, which you may run into with data sets where the decimal is
represented by a comma instead of a period (as with some data sets from
European countries).</p>
<table class="table" id="read-func">
<caption><span class="caption-number">Table 2.1 </span><span class="caption-text">Summary of read_csv and read_excel</span><a class="headerlink" href="#read-func" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Data File Type</p></th>
<th class="head"><p>Python Function</p></th>
<th class="head"><p>Arguments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>) separated files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></td>
<td><p>just the file path</p></td>
</tr>
<tr class="row-odd"><td><p>Tab (<code class="docutils literal notranslate"><span class="pre">\t</span></code>) separated files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sep=&quot;\t&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Missing header</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">header=None</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>European-style numbers, semicolon (<code class="docutils literal notranslate"><span class="pre">;</span></code>) separators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sep=&quot;;&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">thousands=&quot;.&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">decimal=&quot;,&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Excel files (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_excel</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sheet_name</span></code>, <code class="docutils literal notranslate"><span class="pre">usecols</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="reading-data-from-a-database">
<h2><span class="section-number">2.6. </span>Reading data from a database<a class="headerlink" href="#reading-data-from-a-database" title="Permalink to this heading">#</a></h2>
<p id="index-26">Another very common form of data storage is the relational database. Databases
are great when you have large data sets or multiple users
working on a project. There are many relational database management systems,
such as SQLite, MySQL, PostgreSQL, Oracle, and many more. These
different relational database management systems each have their own advantages
and limitations. Almost all employ SQL (<em>structured query language</em>) to obtain
data from the database. But you don’t need to know SQL to analyze data from
a database; several packages have been written that allow you to connect to
relational databases and use the Python programming language
to obtain data. In this book, we will give examples of how to do this
using Python with SQLite and PostgreSQL databases.</p>
<section id="reading-data-from-a-sqlite-database">
<h3><span class="section-number">2.6.1. </span>Reading data from a SQLite database<a class="headerlink" href="#reading-data-from-a-sqlite-database" title="Permalink to this heading">#</a></h3>
<p id="index-27">SQLite is probably the simplest relational database system
that one can use in combination with Python. SQLite databases are self-contained, and are
usually stored and accessed locally on one computer from
a file with a <code class="docutils literal notranslate"><span class="pre">.db</span></code> extension (or sometimes a <code class="docutils literal notranslate"><span class="pre">.sqlite</span></code> extension).
Similar to Excel files, these are not plain text files and cannot be read in a plain text editor.</p>
<span class="target" id="index-28"></span><span class="target" id="index-29"></span><p id="index-30">The first thing you need to do to read data into Python from a database is to
connect to the database. For an SQLite database, we will do that using
the <code class="docutils literal notranslate"><span class="pre">connect</span></code> function from the
<code class="docutils literal notranslate"><span class="pre">sqlite</span></code> backend in the
<code class="docutils literal notranslate"><span class="pre">ibis</span></code> package. This command does not read
in the data, but simply tells Python where the database is and opens up a
communication channel that Python can use to send SQL commands to the database.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is another database package in python called <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code>.
That package is a bit more mature than <code class="docutils literal notranslate"><span class="pre">ibis</span></code>,
so if you want to dig deeper into working with databases in Python, that is a good next
package to learn about. We will work with <code class="docutils literal notranslate"><span class="pre">ibis</span></code> in this book, as it
provides a more modern and friendlier syntax that is more like <code class="docutils literal notranslate"><span class="pre">pandas</span></code> for data analysis code.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ibis</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;data/can_lang.db&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p id="index-31">Often relational databases have many tables; thus, in order to retrieve
data from a database, you need to know the name of the table
in which the data is stored. You can get the names of
all the tables in the database using the <code class="docutils literal notranslate"><span class="pre">list_tables</span></code>
function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">list_tables</span><span class="p">()</span>
<span class="n">tables</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;can_lang&#39;]
</pre></div>
</div>
</div>
</div>
<p id="index-32">The <code class="docutils literal notranslate"><span class="pre">list_tables</span></code> function returned only one name—<code class="docutils literal notranslate"><span class="pre">&quot;can_lang&quot;</span></code>—which tells us
that there is only one table in this database. To reference a table in the
database (so that we can perform operations like selecting columns and filtering rows), we
use the <code class="docutils literal notranslate"><span class="pre">table</span></code> function from the <code class="docutils literal notranslate"><span class="pre">conn</span></code> object. The object returned
by the <code class="docutils literal notranslate"><span class="pre">table</span></code> function allows us to work with data
stored in databases as if they were just regular <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frames; but secretly, behind
the scenes, <code class="docutils literal notranslate"><span class="pre">ibis</span></code> will turn your commands into SQL queries!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;can_lang&quot;</span><span class="p">)</span>
<span class="n">canlang_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">DatabaseTable: can_lang
  category      string
  language      string
  mother_tongue float64
  most_at_home  float64
  most_at_work  float64
  lang_known    float64
</pre>
</div></div>
</div>
<span class="target" id="index-33"></span><p id="index-34">Although it looks like we might have obtained the whole data frame from the database, we didn’t!
It’s a <em>reference</em>; the data is still stored only in the SQLite database. The <code class="docutils literal notranslate"><span class="pre">canlang_table</span></code> object
is a <code class="docutils literal notranslate"><span class="pre">DatabaseTable</span></code>, which, when printed, tells
you which columns are available in the table. But unlike a usual <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame,
we do not immediately know how many rows are in the table. In order to find out how many
rows there are, we have to send an SQL <em>query</em> (i.e., command) to the data base.
In <code class="docutils literal notranslate"><span class="pre">ibis</span></code>, we can do that using the <code class="docutils literal notranslate"><span class="pre">count</span></code> function from the table object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r0 := DatabaseTable: can_lang
  category      string
  language      string
  mother_tongue float64
  most_at_home  float64
  most_at_work  float64
  lang_known    float64

CountStar(can_lang): CountStar(r0)
</pre></div>
</div>
</div>
</div>
<p id="index-35">Wait a second…this isn’t the number of rows in the database. In fact, we haven’t actually sent our
SQL query to the database yet! We need to explicitly tell <code class="docutils literal notranslate"><span class="pre">ibis</span></code> when we want to send the query.
The reason for this is that databases are often more efficient at working with (i.e., selecting, filtering,
joining, etc.) large data sets than Python. And typically, the database will not even
be stored on your computer, but rather a more powerful machine somewhere on the
web. So <code class="docutils literal notranslate"><span class="pre">ibis</span></code> is lazy and waits to bring this data into memory until you explicitly
tell it to using the <code class="docutils literal notranslate"><span class="pre">execute</span></code> function. The <code class="docutils literal notranslate"><span class="pre">execute</span></code> function actually sends the SQL query
to the database, and gives you the result. Let’s look at the number of rows in the table by executing
the <code class="docutils literal notranslate"><span class="pre">count</span></code> command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>214
</pre></div>
</div>
</div>
</div>
<p>There we go! There are 214 rows in the <code class="docutils literal notranslate"><span class="pre">can_lang</span></code> table. If you are interested in seeing
the <em>actual</em> text of the SQL query that <code class="docutils literal notranslate"><span class="pre">ibis</span></code> sends to the database, you can use the <code class="docutils literal notranslate"><span class="pre">compile</span></code> function
instead of <code class="docutils literal notranslate"><span class="pre">execute</span></code>. But note that you have to pass the result of <code class="docutils literal notranslate"><span class="pre">compile</span></code> to the <code class="docutils literal notranslate"><span class="pre">str</span></code> function to turn it into
a human-readable string first.</p>
<span class="target" id="index-36"></span><div class="cell docutils container" id="index-37">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="n">canlang_table</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;SELECT count(*) AS &quot;CountStar(can_lang)&quot; \nFROM can_lang AS t0&#39;
</pre></div>
</div>
</div>
</div>
<p>The output above shows the SQL code that is sent to the database. When we
write <code class="docutils literal notranslate"><span class="pre">canlang_table.count().execute()</span></code> in Python, in the background, the <code class="docutils literal notranslate"><span class="pre">execute</span></code> function is
translating the Python code into SQL, sending that SQL to the database, and then translating the
response for us. So <code class="docutils literal notranslate"><span class="pre">ibis</span></code> does all the hard work of translating from Python to SQL and back for us;
we can just stick with Python!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ibis</span></code> package provides lots of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>-like tools for working with database tables.
For example, we can look at the first few rows of the table by using the <code class="docutils literal notranslate"><span class="pre">head</span></code> function,
followed by <code class="docutils literal notranslate"><span class="pre">execute</span></code> to retrieve the response.</p>
<div class="cell tag_output_scroll docutils container" id="index-38">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590.0</td>
      <td>235.0</td>
      <td>30.0</td>
      <td>665.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260.0</td>
      <td>4785.0</td>
      <td>85.0</td>
      <td>23415.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150.0</td>
      <td>445.0</td>
      <td>10.0</td>
      <td>2775.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460.0</td>
      <td>5985.0</td>
      <td>25.0</td>
      <td>22150.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895.0</td>
      <td>13135.0</td>
      <td>345.0</td>
      <td>31930.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Aboriginal languages</td>
      <td>Algonquian languages, n.i.e.</td>
      <td>45.0</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>120.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Aboriginal languages</td>
      <td>Algonquin</td>
      <td>1260.0</td>
      <td>370.0</td>
      <td>40.0</td>
      <td>2480.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>American Sign Language</td>
      <td>2685.0</td>
      <td>3020.0</td>
      <td>1145.0</td>
      <td>21930.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Amharic</td>
      <td>22465.0</td>
      <td>12785.0</td>
      <td>200.0</td>
      <td>33670.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Arabic</td>
      <td>419890.0</td>
      <td>223535.0</td>
      <td>5585.0</td>
      <td>629055.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can see that <code class="docutils literal notranslate"><span class="pre">ibis</span></code> actually returned a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame to us after we executed the query,
which is very convenient for working with the data after getting it from the database.
So now that we have the <code class="docutils literal notranslate"><span class="pre">canlang_table</span></code> table reference for the 2016 Canadian Census data in hand, we
can mostly continue onward as if it were a regular data frame. For example, let’s do the same exercise
from <a class="reference internal" href="intro.html#intro"><span class="std std-numref">Chapter 1</span></a>: we will obtain only those rows corresponding to Aboriginal languages, and keep only
the <code class="docutils literal notranslate"><span class="pre">language</span></code> and <code class="docutils literal notranslate"><span class="pre">mother_tongue</span></code> columns.
We can use the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operation with a logical statement
to obtain only certain rows. Below we filter the data to include only Aboriginal languages.</p>
<div class="cell docutils container" id="index-39">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table_filtered</span> <span class="o">=</span> <span class="n">canlang_table</span><span class="p">[</span><span class="n">canlang_table</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Aboriginal languages&quot;</span><span class="p">]</span>
<span class="n">canlang_table_filtered</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">r0 := DatabaseTable: can_lang
  category      string
  language      string
  mother_tongue float64
  most_at_home  float64
  most_at_work  float64
  lang_known    float64

Selection[r0]
  predicates:
    r0.category == 'Aboriginal languages'
</pre>
</div></div>
</div>
<p>Above you can see that we have not yet executed this command; <code class="docutils literal notranslate"><span class="pre">canlang_table_filtered</span></code> is just showing
the first part of our query (the part that starts with <code class="docutils literal notranslate"><span class="pre">Selection[r0]</span></code> above).
We didn’t call <code class="docutils literal notranslate"><span class="pre">execute</span></code> because we are not ready to bring the data into Python yet.
We can still use the database to do some work to obtain <em>only</em> the small amount of data we want to work with locally
in Python. Let’s add the second part of our SQL query: selecting only the <code class="docutils literal notranslate"><span class="pre">language</span></code> and <code class="docutils literal notranslate"><span class="pre">mother_tongue</span></code> columns.</p>
<div class="cell docutils container" id="index-40">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table_selected</span> <span class="o">=</span> <span class="n">canlang_table_filtered</span><span class="p">[[</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;mother_tongue&quot;</span><span class="p">]]</span>
<span class="n">canlang_table_selected</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">r0 := DatabaseTable: can_lang
  category      string
  language      string
  mother_tongue float64
  most_at_home  float64
  most_at_work  float64
  lang_known    float64

r1 := Selection[r0]
  predicates:
    r0.category == 'Aboriginal languages'

Selection[r1]
  selections:
    language:      r1.language
    mother_tongue: r1.mother_tongue
</pre>
</div></div>
</div>
<p>Now you can see that the <code class="docutils literal notranslate"><span class="pre">ibis</span></code> query will have two steps: it will first find rows corresponding to
Aboriginal languages, then it will extract only the <code class="docutils literal notranslate"><span class="pre">language</span></code> and <code class="docutils literal notranslate"><span class="pre">mother_tongue</span></code> columns that we are interested in.
Let’s actually execute the query now to bring the data into Python as a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame, and print the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aboriginal_lang_data</span> <span class="o">=</span> <span class="n">canlang_table_selected</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">aboriginal_lang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
      <th>mother_tongue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Algonquian languages, n.i.e.</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Algonquin</td>
      <td>1260.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Athabaskan languages, n.i.e.</td>
      <td>50.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Atikamekw</td>
      <td>6150.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Thompson (Ntlakapamux)</td>
      <td>335.0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Tlingit</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Tsimshian</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Wakashan languages, n.i.e.</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Woods Cree</td>
      <td>1840.0</td>
    </tr>
  </tbody>
</table>
<p>67 rows × 2 columns</p>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ibis</span></code> provides many more functions (not just the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operation)
that you can use to manipulate the data within the database before calling
<code class="docutils literal notranslate"><span class="pre">execute</span></code> to obtain the data in Python. But <code class="docutils literal notranslate"><span class="pre">ibis</span></code> does not provide <em>every</em> function
that we need for analysis; we do eventually need to call <code class="docutils literal notranslate"><span class="pre">execute</span></code>.
For example, <code class="docutils literal notranslate"><span class="pre">ibis</span></code> does not provide the <code class="docutils literal notranslate"><span class="pre">tail</span></code> function to look at the last
rows in a database, even though <code class="docutils literal notranslate"><span class="pre">pandas</span></code> does.</p>
<div class="cell tag_output_scroll docutils container" id="index-41">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_table_selected</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">24</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">canlang_table_selected</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="nn">File /opt/conda/lib/python3.11/site-packages/ibis/expr/types/relations.py:645,</span> in <span class="ni">Table.__getattr__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">    </span><span class="mi">641</span>     <span class="n">hint</span> <span class="o">=</span> <span class="n">common_typos</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">642</span>     <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">643</span>         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object has no attribute </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2">, did you mean </span><span class="si">{</span><span class="n">hint</span><span class="si">!r}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">645</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;Table&#39; object has no attribute </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">AttributeError</span>: &#39;Table&#39; object has no attribute &#39;tail&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aboriginal_lang_data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
      <th>mother_tongue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>61</th>
      <td>Tahltan</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Thompson (Ntlakapamux)</td>
      <td>335.0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Tlingit</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Tsimshian</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Wakashan languages, n.i.e.</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Woods Cree</td>
      <td>1840.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>So once you have finished your data wrangling of the database reference object, it is advisable to
bring it into Python as a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame using the <code class="docutils literal notranslate"><span class="pre">execute</span></code> function.
But be very careful using <code class="docutils literal notranslate"><span class="pre">execute</span></code>: databases are often <em>very</em> big,
and reading an entire table into Python might take a long time to run or even possibly
crash your machine. So make sure you select and filter the database table
to reduce the data to a reasonable size before using <code class="docutils literal notranslate"><span class="pre">execute</span></code> to read it into Python!</p>
</section>
<section id="reading-data-from-a-postgresql-database">
<h3><span class="section-number">2.6.2. </span>Reading data from a PostgreSQL database<a class="headerlink" href="#reading-data-from-a-postgresql-database" title="Permalink to this heading">#</a></h3>
<p id="index-42">PostgreSQL (also called Postgres) is a very popular
and open-source option for relational database software.
Unlike SQLite,
PostgreSQL uses a client–server database engine, as it was designed to be used
and accessed on a network. This means that you have to provide more information
to Python when connecting to Postgres databases. The additional information that you
need to include when you call the <code class="docutils literal notranslate"><span class="pre">connect</span></code> function is listed below:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">database</span></code>: the name of the database (a single PostgreSQL instance can host more than one database)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: the URL pointing to where the database is located (<code class="docutils literal notranslate"><span class="pre">localhost</span></code> if it is on your local machine)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: the communication endpoint between Python and the PostgreSQL database (usually <code class="docutils literal notranslate"><span class="pre">5432</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: the username for accessing the database</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code>: the password for accessing the database</p></li>
</ul>
<p>Below we demonstrate how to connect to a version of
the <code class="docutils literal notranslate"><span class="pre">can_mov_db</span></code> database, which contains information about Canadian movies.
Note that the <code class="docutils literal notranslate"><span class="pre">host</span></code> (<code class="docutils literal notranslate"><span class="pre">fakeserver.stat.ubc.ca</span></code>), <code class="docutils literal notranslate"><span class="pre">user</span></code> (<code class="docutils literal notranslate"><span class="pre">user0001</span></code>), and
<code class="docutils literal notranslate"><span class="pre">password</span></code> (<code class="docutils literal notranslate"><span class="pre">abc123</span></code>) below are <em>not real</em>; you will not actually
be able to connect to a database using this information.</p>
<div class="cell tag_remove-output docutils container" id="index-43">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">postgres</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;can_mov_db&quot;</span><span class="p">,</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;fakeserver.stat.ubc.ca&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">5432</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;user0001&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;abc123&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Aside from needing to provide that additional information, <code class="docutils literal notranslate"><span class="pre">ibis</span></code> makes it so
that connecting to and working with a Postgres database is identical to
connecting to and working with an SQLite database. For example, we can again use
<code class="docutils literal notranslate"><span class="pre">list_tables</span></code> to find out what tables are in the <code class="docutils literal notranslate"><span class="pre">can_mov_db</span></code> database:</p>
<div class="cell tag_remove-output docutils container" id="index-44">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">list_tables</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&quot;themes&quot;, &quot;medium&quot;, &quot;titles&quot;, &quot;title_aliases&quot;, &quot;forms&quot;, &quot;episodes&quot;, &quot;names&quot;, &quot;names_occupations&quot;, &quot;occupation&quot;, &quot;ratings&quot;]
</pre></div>
</div>
</div>
</div>
<p>We see that there are 10 tables in this database. Let’s first look at the
<code class="docutils literal notranslate"><span class="pre">&quot;ratings&quot;</span></code> table to find the lowest rating that exists in the <code class="docutils literal notranslate"><span class="pre">can_mov_db</span></code>
database.</p>
<div class="cell tag_remove-output docutils container" id="index-45">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings_table</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;ratings&quot;</span><span class="p">)</span>
<span class="n">ratings_table</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AlchemyTable: ratings
  title           string
  average_rating  float64
  num_votes       int64
</pre></div>
</div>
</div>
</div>
<p id="index-46">To find the lowest rating that exists in the data base, we first need to
select the <code class="docutils literal notranslate"><span class="pre">average_rating</span></code> column:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_rating</span> <span class="o">=</span> <span class="n">ratings_table</span><span class="p">[[</span><span class="s2">&quot;average_rating&quot;</span><span class="p">]]</span>
<span class="n">avg_rating</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r0 := AlchemyTable: ratings
  title           string
  average_rating  float64
  num_votes       int64

Selection[r0]
  selections:
    average_rating: r0.average_rating
</pre></div>
</div>
</div>
</div>
<p id="index-47">Next we use the <code class="docutils literal notranslate"><span class="pre">order_by</span></code> function from <code class="docutils literal notranslate"><span class="pre">ibis</span></code> order the table by <code class="docutils literal notranslate"><span class="pre">average_rating</span></code>,
and then the <code class="docutils literal notranslate"><span class="pre">head</span></code> function to select the first row (i.e., the lowest score).</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lowest</span> <span class="o">=</span> <span class="n">avg_rating</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;average_rating&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">lowest</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We see the lowest rating given to a movie is 1, indicating that it must have
been a really bad movie…</p>
</section>
<section id="why-should-we-bother-with-databases-at-all">
<h3><span class="section-number">2.6.3. </span>Why should we bother with databases at all?<a class="headerlink" href="#why-should-we-bother-with-databases-at-all" title="Permalink to this heading">#</a></h3>
<p id="index-48">Opening a database involved a lot more effort than just opening a <code class="docutils literal notranslate"><span class="pre">.csv</span></code>, or any of the
other plain text or Excel formats. We had to open a connection to the database,
then use <code class="docutils literal notranslate"><span class="pre">ibis</span></code> to translate <code class="docutils literal notranslate"><span class="pre">pandas</span></code>-like
commands (the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operation, <code class="docutils literal notranslate"><span class="pre">head</span></code>, etc.) into SQL queries that the database
understands, and then finally <code class="docutils literal notranslate"><span class="pre">execute</span></code> them. And not all <code class="docutils literal notranslate"><span class="pre">pandas</span></code> commands can currently be translated
via <code class="docutils literal notranslate"><span class="pre">ibis</span></code> into database queries. So you might be wondering: why should we use
databases at all?</p>
<p>Databases are beneficial in a large-scale setting:</p>
<ul class="simple">
<li><p>They enable storing large data sets across multiple computers with backups.</p></li>
<li><p>They provide mechanisms for ensuring data integrity and validating input.</p></li>
<li><p>They provide security and data access control.</p></li>
<li><p>They allow multiple users to access data simultaneously
and remotely without conflicts and errors.
For example, there are billions of Google searches conducted daily in 2021 <span id="id1">[<a class="reference internal" href="#id19" title="Real Time Statistics Project. Internet live stats: google search statistics. 2021. URL: https://www.internetlivestats.com/google-search-statistics/.">Real Time Statistics Project, 2021</a>]</span>.
Can you imagine if Google stored all of the data
from those searches in a single <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file!? Chaos would ensue!</p></li>
</ul>
</section>
</section>
<section id="writing-data-from-python-to-a-csv-file">
<h2><span class="section-number">2.7. </span>Writing data from Python to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file<a class="headerlink" href="#writing-data-from-python-to-a-csv-file" title="Permalink to this heading">#</a></h2>
<p id="index-49">At the middle and end of a data analysis, we often want to write a data frame
that has changed (through selecting columns, filtering rows, etc.)
to a file to share it with others or use it for another step in the analysis.
The most straightforward way to do this is to use the <code class="docutils literal notranslate"><span class="pre">to_csv</span></code> function
from the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package.  The default
arguments are to use a comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>) as the separator, and to include column names
in the first row. We also specify <code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">=</span> <span class="pre">False</span></code> to tell <code class="docutils literal notranslate"><span class="pre">pandas</span></code> not to print
row numbers in the <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file. Below we demonstrate creating a new version of the Canadian
languages data set without the “Official languages” category according to the
Canadian 2016 Census, and then writing this to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_official_lang_data</span> <span class="o">=</span> <span class="n">canlang_data</span><span class="p">[</span><span class="n">canlang_data</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Official languages&quot;</span><span class="p">]</span>
<span class="n">no_official_lang_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/no_official_languages.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtaining-data-from-the-web">
<h2><span class="section-number">2.8. </span>Obtaining data from the web<a class="headerlink" href="#obtaining-data-from-the-web" title="Permalink to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is not required reading for the remainder of the textbook. It
is included for those readers interested in learning a little bit more about
how to obtain different types of data from the web.</p>
</div>
<span class="target" id="index-50"></span><p id="index-51">Data doesn’t just magically appear on your computer; you need to get it from
somewhere. Earlier in the chapter we showed you how to access data stored in a
plain text, spreadsheet-like format (e.g., comma- or tab-separated) from a web
URL using the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function from <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. But as time goes on, it is
increasingly uncommon to find data (especially large amounts of data) in this
format available for download from a URL. Instead, websites now often offer
something known as an <strong>a</strong>pplication <strong>p</strong>rogramming <strong>i</strong>nterface (API),
which provides a programmatic way to ask for subsets of a data set. This allows
the website owner to control <em>who</em> has access to the data, <em>what portion</em> of
the data they have access to, and <em>how much</em> data they can access.  Typically,
the website owner will give you a <em>token</em> or <em>key</em> (a secret string of characters
somewhat like a password) that you have to provide when accessing the API.</p>
<span class="target" id="index-52"></span><span class="target" id="index-53"></span><p id="index-54">Another interesting thought: websites themselves <em>are</em> data! When you type a
URL into your browser window, your browser asks the <em>web server</em> (another
computer on the internet whose job it is to respond to requests for the
website) to give it the website’s data, and then your browser translates that
data into something you can see. If the website shows you some information that
you’re interested in, you could <em>create</em> a data set for yourself by copying and
pasting that information into a file. This process of taking information
directly from what a website displays is called
<em>web scraping</em> (or sometimes <em>screen scraping</em>). Now, of course, copying and pasting
information manually is a painstaking and error-prone process, especially when
there is a lot of information to gather. So instead of asking your browser to
translate the information that the web server provides into something you can
see, you can collect that data programmatically—in the form of
<strong>h</strong>yper<strong>t</strong>ext <strong>m</strong>arkup <strong>l</strong>anguage (HTML) and <strong>c</strong>ascading <strong>s</strong>tyle <strong>s</strong>heet (CSS)
code—and process it to extract useful information. HTML provides the
basic structure of a site and tells the webpage how to display the content
(e.g., titles, paragraphs, bullet lists etc.), whereas CSS helps style the
content and tells the webpage how the HTML elements should
be presented (e.g., colors, layouts, fonts etc.).</p>
<p>This subsection will show you the basics of both web scraping
with the <a class="reference external" href="https://beautiful-soup-4.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> Python package</a> <span id="id2">[<a class="reference internal" href="#id70" title="Leonard Richardson. Beautiful soup documentation. April, 2007.">Richardson, 2007</a>]</span>
and accessing the NASA “Astronomy Picture of the Day” API
using the <a class="reference external" href="https://requests.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">requests</span></code> Python package</a> <span id="id3">[<a class="reference internal" href="#id71" title="Kenneth Reitz and The Python Software Foundation. Requests: http for humans. URL: https://requests.readthedocs.io/en/latest/, Accessed Online: 2023.">Reitz and The Python Software Foundation, Accessed Online: 2023</a>]</span>.</p>
<section id="web-scraping">
<h3><span class="section-number">2.8.1. </span>Web scraping<a class="headerlink" href="#web-scraping" title="Permalink to this heading">#</a></h3>
<section id="html-and-css-selectors">
<h4>HTML and CSS selectors<a class="headerlink" href="#html-and-css-selectors" title="Permalink to this heading">#</a></h4>
<p id="index-55">When you enter a URL into your browser, your browser connects to the
web server at that URL and asks for the <em>source code</em> for the website.
This is the data that the browser translates
into something you can see; so if we
are going to create our own data by scraping a website, we have to first understand
what that data looks like! For example, let’s say we are interested
in knowing the average rental price (per square foot) of the most recently
available one-bedroom apartments in Vancouver
on <a class="reference external" href="https://vancouver.craigslist.org">Craiglist</a>. When we visit the Vancouver Craigslist
website and search for one-bedroom apartments,
we should see something similar to <a class="reference internal" href="#fig-craigslist-human"><span class="std std-numref">Fig. 2.2</span></a>.</p>
<figure class="align-default" id="fig-craigslist-human">
<img alt="_images/craigslist_human.png" src="_images/craigslist_human.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.2 </span><span class="caption-text">Craigslist webpage of advertisements for one-bedroom apartments.</span><a class="headerlink" href="#fig-craigslist-human" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Based on what our browser shows us, it’s pretty easy to find the size and price
for each apartment listed. But we would like to be able to obtain that information
using Python, without any manual human effort or copying and pasting. We do this by
examining the <em>source code</em> that the web server actually sent our browser to
display for us. We show a snippet of it below; the
entire source
is <a class="reference external" href="https://github.com/UBC-DSCI/introduction-to-datascience-python/blob/main/source/data/website_source.txt">included with the code for this book</a>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-meta&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-price&quot;</span><span class="p">&gt;</span>$800<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;housing&quot;</span><span class="p">&gt;</span>
            1br -
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-hood&quot;</span><span class="p">&gt;</span> (13768 108th Avenue)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-tags&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;maptag&quot;</span> <span class="na">data-pid</span><span class="o">=</span><span class="s">&quot;6786042973&quot;</span><span class="p">&gt;</span>map<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;banish icon icon-trash&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;screen-reader-text&quot;</span><span class="p">&gt;</span>hide this posting<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;unbanish icon icon-trash red&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;restore-link&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;restore-narrow-text&quot;</span><span class="p">&gt;</span>restore<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;restore-wide-text&quot;</span><span class="p">&gt;</span>restore this posting<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-price&quot;</span><span class="p">&gt;</span>$2285<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Oof…you can tell that the source code for a web page is not really designed
for humans to understand easily. However, if you look through it closely, you
will find that the information we’re interested in is hidden among the muck.
For example, near the top of the snippet
above you can see a line that looks like</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-price&quot;</span><span class="p">&gt;</span>$800<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>That snippet is definitely storing the price of a particular apartment. With some more
investigation, you should be able to find things like the date and time of the
listing, the address of the listing, and more. So this source code most likely
contains all the information we are interested in!</p>
<p id="index-56">Let’s dig into that line above a bit more. You can see that
that bit of code has an <em>opening tag</em> (words between <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, like
<code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>) and a <em>closing tag</em> (the same with a slash, like <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code>). HTML
source code generally stores its data between opening and closing tags like
these. Tags are keywords that tell the web browser how to display or format
the content. Above you can see that the information we want (<code class="docutils literal notranslate"><span class="pre">$800</span></code>) is stored
between an opening and closing tag (<code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code>). In the opening
tag, you can also see a very useful “class” (a special word that is sometimes
included with opening tags): <code class="docutils literal notranslate"><span class="pre">class=&quot;result-price&quot;</span></code>. Since we want R to
programmatically sort through all of the source code for the website to find
apartment prices, maybe we can look for all the tags with the <code class="docutils literal notranslate"><span class="pre">&quot;result-price&quot;</span></code>
class, and grab the information between the opening and closing tag. Indeed,
take a look at another line of the source snippet above:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;result-price&quot;</span><span class="p">&gt;</span>$2285<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>It’s yet another price for an apartment listing, and the tags surrounding it
have the <code class="docutils literal notranslate"><span class="pre">&quot;result-price&quot;</span></code> class. Wonderful! Now that we know what pattern we
are looking for—a dollar amount between opening and closing tags that have the
<code class="docutils literal notranslate"><span class="pre">&quot;result-price&quot;</span></code> class—we should be able to use code to pull out all of the
matching patterns from the source code to obtain our data. This sort of “pattern”
is known as a <em>CSS selector</em> (where CSS stands for <strong>c</strong>ascading <strong>s</strong>tyle <strong>s</strong>heet).</p>
<p>The above was a simple example of “finding the pattern to look for”; many
websites are quite a bit larger and more complex, and so is their website
source code. Fortunately, there are tools available to make this process
easier. For example,
<a class="reference external" href="https://selectorgadget.com/">SelectorGadget</a> is
an open-source tool that simplifies identifying the generating
and finding of CSS selectors.
At the end of the chapter in the additional resources section, we include a link to
a short video on how to install and use the SelectorGadget tool to
obtain CSS selectors for use in web scraping.
After installing and enabling the tool, you can click the
website element for which you want an appropriate selector. For
example, if we click the price of an apartment listing, we
find that SelectorGadget shows us the selector <code class="docutils literal notranslate"><span class="pre">.result-price</span></code>
in its toolbar, and highlights all the other apartment
prices that would be obtained using that selector (<a class="reference internal" href="#fig-sg1"><span class="std std-numref">Fig. 2.3</span></a>).</p>
<figure class="align-default" id="fig-sg1">
<img alt="_images/sg1.png" src="_images/sg1.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.3 </span><span class="caption-text">Using the SelectorGadget on a Craigslist webpage to obtain the CCS selector useful for obtaining apartment prices.</span><a class="headerlink" href="#fig-sg1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If we then click the size of an apartment listing, SelectorGadget shows us
the <code class="docutils literal notranslate"><span class="pre">span</span></code> selector, and highlights many of the lines on the page; this indicates that the
<code class="docutils literal notranslate"><span class="pre">span</span></code> selector is not specific enough to capture only apartment sizes (<a class="reference internal" href="#fig-sg3"><span class="std std-numref">Fig. 2.4</span></a>).</p>
<figure class="align-default" id="fig-sg3">
<img alt="_images/sg3.png" src="_images/sg3.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.4 </span><span class="caption-text">Using the SelectorGadget on a Craigslist webpage to obtain a CCS selector useful for obtaining apartment sizes.</span><a class="headerlink" href="#fig-sg3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>To narrow the selector, we can click one of the highlighted elements that
we <em>do not</em> want. For example, we can deselect the “pic/map” links,
resulting in only the data we want highlighted using the <code class="docutils literal notranslate"><span class="pre">.housing</span></code> selector (<a class="reference internal" href="#fig-sg2"><span class="std std-numref">Fig. 2.5</span></a>).</p>
<figure class="align-default" id="fig-sg2">
<img alt="_images/sg2.png" src="_images/sg2.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.5 </span><span class="caption-text">Using the SelectorGadget on a Craigslist webpage to refine the CCS selector to one that is most useful for obtaining apartment sizes.</span><a class="headerlink" href="#fig-sg2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>So to scrape information about the square footage and rental price
of apartment listings, we need to use
the two CSS selectors <code class="docutils literal notranslate"><span class="pre">.housing</span></code> and <code class="docutils literal notranslate"><span class="pre">.result-price</span></code>, respectively.
The selector gadget returns them to us as a comma-separated list (here
<code class="docutils literal notranslate"><span class="pre">.housing</span> <span class="pre">,</span> <span class="pre">.result-price</span></code>), which is exactly the format we need to provide to
Python if we are using more than one CSS selector.</p>
<p><strong>Caution: are you allowed to scrape that website?</strong></p>
<p id="index-57"><em>Before</em> scraping data from the web, you should always check whether or not
you are <em>allowed</em> to scrape it! There are two documents that are important
for this: the <code class="docutils literal notranslate"><span class="pre">robots.txt</span></code> file and the Terms of Service
document. If we take a look at <a class="reference external" href="https://www.craigslist.org/about/terms.of.use">Craigslist’s Terms of Service document</a>,
we find the following text: <em>“You agree not to copy/collect CL content
via robots, spiders, scripts, scrapers, crawlers, or any automated or manual equivalent (e.g., by hand).”</em>
So unfortunately, without explicit permission, we are not allowed to scrape the website.</p>
<p id="index-58">What to do now? Well, we <em>could</em> ask the owner of Craigslist for permission to scrape.
However, we are not likely to get a response, and even if we did they would not likely give us permission.
The more realistic answer is that we simply cannot scrape Craigslist. If we still want
to find data about rental prices in Vancouver, we must go elsewhere.
To continue learning how to scrape data from the web, let’s instead
scrape data on the population of Canadian cities from Wikipedia.
We have checked the <a class="reference external" href="https://foundation.wikimedia.org/wiki/Terms_of_Use/en">Terms of Service document</a>,
and it does not mention that web scraping is disallowed.
We will use the SelectorGadget tool to pick elements that we are interested in
(city names and population counts) and deselect others to indicate that we are not
interested in them (province names), as shown in <a class="reference internal" href="#fig-sg4"><span class="std std-numref">Fig. 2.6</span></a>.</p>
<figure class="align-default" id="fig-sg4">
<img alt="_images/sg4.png" src="_images/sg4.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.6 </span><span class="caption-text">Using the SelectorGadget on a Wikipedia webpage.</span><a class="headerlink" href="#fig-sg4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We include a link to a short video tutorial on this process at the end of the chapter
in the additional resources section. SelectorGadget provides in its toolbar
the following list of CSS selectors to use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>td:nth-child(8) ,
td:nth-child(4) ,
.largestCities-cell-background+ td a
</pre></div>
</div>
<p>Now that we have the CSS selectors that describe the properties of the elements
that we want to target, we can use them to find certain elements in web pages and extract data.</p>
</section>
<section id="scraping-with-beautifulsoup">
<h4>Scraping with <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code><a class="headerlink" href="#scraping-with-beautifulsoup" title="Permalink to this heading">#</a></h4>
<p id="index-59">We will use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> and <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> Python packages to scrape data
from the Wikipedia page. After loading those packages, we tell Python which
page we want to scrape by providing its URL in quotations to the <code class="docutils literal notranslate"><span class="pre">requests.get</span></code>
function. This function obtains the raw HTML of the page, which we then
pass to the <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> function for parsing:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">bs4</span>

<span class="n">wiki</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Canada&quot;</span><span class="p">)</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">wiki</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> function downloads the HTML source code for the page at the
URL you specify, just like your browser would if you navigated to this site.
But instead of displaying the website to you, the <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> function just
returns the HTML source code itself—stored in the <code class="docutils literal notranslate"><span class="pre">wiki.content</span></code>
variable—which we then parse using <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> and store in the
<code class="docutils literal notranslate"><span class="pre">page</span></code> variable. Next, we pass the CSS selectors we obtained from
SelectorGadget to the <code class="docutils literal notranslate"><span class="pre">select</span></code> method of the <code class="docutils literal notranslate"><span class="pre">page</span></code> object.  Make sure to
surround the selectors with quotation marks; <code class="docutils literal notranslate"><span class="pre">select</span></code> expects that argument is
a string. We store the result of the <code class="docutils literal notranslate"><span class="pre">select</span></code> function in the <code class="docutils literal notranslate"><span class="pre">population_nodes</span></code>
variable. Note that <code class="docutils literal notranslate"><span class="pre">select</span></code> returns a list; below we slice the list to
print only the first 5 elements for clarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">population_nodes</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="s2">&quot;td:nth-child(8) , td:nth-child(4) , .largestCities-cell-background+ td a&quot;</span>
<span class="p">)</span>
<span class="n">population_nodes</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;a href=&quot;/wiki/Greater_Toronto_Area&quot; title=&quot;Greater Toronto Area&quot;&gt;Toronto&lt;/a&gt;,
 &lt;td style=&quot;text-align:right;&quot;&gt;6,202,225&lt;/td&gt;,
 &lt;a href=&quot;/wiki/London,_Ontario&quot; title=&quot;London, Ontario&quot;&gt;London&lt;/a&gt;,
 &lt;td style=&quot;text-align:right;&quot;&gt;543,551
 &lt;/td&gt;,
 &lt;a href=&quot;/wiki/Greater_Montreal&quot; title=&quot;Greater Montreal&quot;&gt;Montreal&lt;/a&gt;]
</pre></div>
</div>
</div>
</div>
<p>Each of the items in the <code class="docutils literal notranslate"><span class="pre">population_nodes</span></code> list is a <em>node</em> from the HTML document that matches the CSS
selectors you specified. A <em>node</em> is an HTML tag pair (e.g., <code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/td&gt;</span></code>
which defines the cell of a table) combined with the content stored between the
tags. For our CSS selector <code class="docutils literal notranslate"><span class="pre">td:nth-child(4)</span></code>, an example node that would be
selected would be:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">td</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;text-align:left;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/wiki/London,_Ontario&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;London, Ontario&quot;</span><span class="p">&gt;</span>London<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Next, we extract the meaningful data—in other words, we get rid of the
HTML code syntax and tags—from the nodes using the <code class="docutils literal notranslate"><span class="pre">get_text</span></code> function.
In the case of the example node above, <code class="docutils literal notranslate"><span class="pre">get_text</span></code> function returns <code class="docutils literal notranslate"><span class="pre">&quot;London&quot;</span></code>.
Once again we show only the first 5 elements for clarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">population_nodes</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Toronto&#39;, &#39;6,202,225&#39;, &#39;London&#39;, &#39;543,551\n&#39;, &#39;Montreal&#39;]
</pre></div>
</div>
</div>
</div>
<p>Fantastic! We seem to have extracted the data of interest from the raw HTML
source code. But we are not quite done; the data is not yet in an optimal
format for data analysis. Both the city names and population are encoded as
characters in a single vector, instead of being in a data frame with one
character column for city and one numeric column for population (like a
spreadsheet).  Additionally, the populations contain commas (not useful for
programmatically dealing with numbers), and some even contain a line break
character at the end (<code class="docutils literal notranslate"><span class="pre">\n</span></code>). In <a class="reference internal" href="wrangling.html#wrangling"><span class="std std-numref">Chapter 3</span></a>, we will learn
more about how to <em>wrangle</em> data such as this into a more useful format for
data analysis using Python.</p>
</section>
<section id="scraping-with-read-html">
<h4>Scraping with <code class="docutils literal notranslate"><span class="pre">read_html</span></code><a class="headerlink" href="#scraping-with-read-html" title="Permalink to this heading">#</a></h4>
<p>Using <code class="docutils literal notranslate"><span class="pre">requests</span></code> and <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> to extract data based on CSS selectors is
a very general way to scrape data from the web, albeit perhaps a little bit
complicated.  Fortunately, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> provides the
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.read_html.html"><code class="docutils literal notranslate"><span class="pre">read_html</span></code></a>
function, which is easier method to try when the data
appear on the webpage already in a tabular format.  The <code class="docutils literal notranslate"><span class="pre">read_html</span></code> function takes one
argument—the URL of the page to scrape—and will return a list of
data frames corresponding to all the tables it finds at that URL. We can see
below that <code class="docutils literal notranslate"><span class="pre">read_html</span></code> found 17 tables on the Wikipedia page for Canada.</p>
<div class="cell tag_remove-output docutils container" id="index-60">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canada_wiki_tables</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Canada&quot;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">canada_wiki_tables</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17
</pre></div>
</div>
</div>
</div>
<p>After manually searching through these, we find that the table containing the
population counts of the largest metropolitan areas in Canada is contained in
index 1. We use the <code class="docutils literal notranslate"><span class="pre">droplevel</span></code> method to simplify the column names in the resulting
data frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canada_wiki_df</span> <span class="o">=</span> <span class="n">canada_wiki_tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">canada_wiki_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">canada_wiki_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">()</span>
<span class="n">canada_wiki_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rank</th>
      <th>Name</th>
      <th>Province</th>
      <th>Pop.</th>
      <th>Rank.1</th>
      <th>Name.1</th>
      <th>Province.1</th>
      <th>Pop..1</th>
      <th>Unnamed: 8_level_1</th>
      <th>Unnamed: 9_level_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toronto</td>
      <td>Ontario</td>
      <td>6202225</td>
      <td>11</td>
      <td>London</td>
      <td>Ontario</td>
      <td>543551</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Montreal</td>
      <td>Quebec</td>
      <td>4291732</td>
      <td>12</td>
      <td>Halifax</td>
      <td>Nova Scotia</td>
      <td>465703</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Vancouver</td>
      <td>British Columbia</td>
      <td>2642825</td>
      <td>13</td>
      <td>St. Catharines–Niagara</td>
      <td>Ontario</td>
      <td>433604</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Ottawa–Gatineau</td>
      <td>Ontario–Quebec</td>
      <td>1488307</td>
      <td>14</td>
      <td>Windsor</td>
      <td>Ontario</td>
      <td>422630</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Calgary</td>
      <td>Alberta</td>
      <td>1481806</td>
      <td>15</td>
      <td>Oshawa</td>
      <td>Ontario</td>
      <td>415311</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>Edmonton</td>
      <td>Alberta</td>
      <td>1418118</td>
      <td>16</td>
      <td>Victoria</td>
      <td>British Columbia</td>
      <td>397237</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>Quebec City</td>
      <td>Quebec</td>
      <td>839311</td>
      <td>17</td>
      <td>Saskatoon</td>
      <td>Saskatchewan</td>
      <td>317480</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>Winnipeg</td>
      <td>Manitoba</td>
      <td>834678</td>
      <td>18</td>
      <td>Regina</td>
      <td>Saskatchewan</td>
      <td>249217</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>Hamilton</td>
      <td>Ontario</td>
      <td>785184</td>
      <td>19</td>
      <td>Sherbrooke</td>
      <td>Quebec</td>
      <td>227398</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>Kitchener–Cambridge–Waterloo</td>
      <td>Ontario</td>
      <td>575847</td>
      <td>20</td>
      <td>Kelowna</td>
      <td>British Columbia</td>
      <td>222162</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Once again, we have managed to extract the data of interest from the raw HTML
source code—but this time using the convenient <code class="docutils literal notranslate"><span class="pre">read_html</span></code> function,
without needing to explicitly use CSS selectors! However, once again, we still
need to do some cleaning of this result. Referring back to <a class="reference internal" href="#fig-sg4"><span class="std std-numref">Fig. 2.6</span></a>,
we can see that the table is formatted with two sets of columns (e.g., <code class="docutils literal notranslate"><span class="pre">Name</span></code>
and <code class="docutils literal notranslate"><span class="pre">Name.1</span></code>) that we will need to somehow merge. In <a class="reference internal" href="wrangling.html#wrangling"><span class="std std-numref">Chapter 3</span></a>, we will learn more about how to <em>wrangle</em> data into a useful
format for data analysis.</p>
</section>
</section>
<section id="using-an-api">
<h3><span class="section-number">2.8.2. </span>Using an API<a class="headerlink" href="#using-an-api" title="Permalink to this heading">#</a></h3>
<p id="index-61">Rather than posting a data file at a URL for you to download, many websites
these days provide an API that can be accessed through a programming language
like Python. The benefit of using an API is that data owners have much more control
over the data they provide to users. However, unlike web scraping, there is no
consistent way to access an API across websites. Every website typically has
its own API designed especially for its own use case. Therefore we will just
provide one example of accessing data through an API in this book, with the
hope that it gives you enough of a basic idea that you can learn how to use
another API if needed. In particular, in this book we will show you the basics
of how to use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> package in Python to access data from the NASA “Astronomy Picture
of the Day” API (a great source of desktop backgrounds, by the way—take a look at the stunning
picture of the Rho-Ophiuchi cloud complex <span id="id4">[<a class="reference internal" href="#id72" title="NASA, ESA, CSA, STScI, K. Pontoppidan (STScI), and A. Pagan (STScI). Rho ophiuchi cloud complex. URL: https://esawebb.org/images/weic2316a/, Accessed Online: 2023.">NASA <em>et al.</em>, Accessed Online: 2023</a>]</span> in <a class="reference internal" href="#fig-nasa-api-rho-ophiuchi"><span class="std std-numref">Fig. 2.7</span></a> from July 13, 2023!).</p>
<figure class="align-default" id="fig-nasa-api-rho-ophiuchi">
<span id="index-62"></span><a class="reference internal image-reference" href="_images/NASA-API-Rho-Ophiuchi.png"><img alt="_images/NASA-API-Rho-Ophiuchi.png" src="_images/NASA-API-Rho-Ophiuchi.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.7 </span><span class="caption-text">The James Webb Space Telescope’s NIRCam image of the Rho Ophiuchi molecular cloud complex.</span><a class="headerlink" href="#fig-nasa-api-rho-ophiuchi" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>First, you will need to visit the <a class="reference external" href="https://api.nasa.gov/">NASA APIs page</a> and generate an API key (i.e., a password used to identify you when accessing the API).
Note that a valid email address is required to
associate with the key. The signup form looks something like <a class="reference internal" href="#fig-nasa-api-signup"><span class="std std-numref">Fig. 2.8</span></a>.
After filling out the basic information, you will receive the token via email.
Make sure to store the key in a safe place, and keep it private.</p>
<figure class="align-default" id="fig-nasa-api-signup">
<img alt="_images/NASA-API-signup.png" src="_images/NASA-API-signup.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.8 </span><span class="caption-text">Generating the API access token for the NASA API.</span><a class="headerlink" href="#fig-nasa-api-signup" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p><strong>Caution: think about your API usage carefully!</strong></p>
<p>When you access an API, you are initiating a transfer of data from a web server
to your computer. Web servers are expensive to run and do not have infinite resources.
If you try to ask for <em>too much data</em> at once, you can use up a huge amount of the server’s bandwidth.
If you try to ask for data <em>too frequently</em>—e.g., if you
make many requests to the server in quick succession—you can also bog the server down and make
it unable to talk to anyone else. Most servers have mechanisms to revoke your access if you are not
careful, but you should try to prevent issues from happening in the first place by being extra careful
with how you write and run your code. You should also keep in mind that when a website owner
grants you API access, they also usually specify a limit (or <em>quota</em>) of how much data you can ask for.
Be careful not to overrun your quota! So <em>before</em> we try to use the API, we will first visit
<a class="reference external" href="https://api.nasa.gov/">the NASA website</a> to see what limits we should abide by when using the API.
These limits are outlined in <a class="reference internal" href="#fig-nasa-api-limits"><span class="std std-numref">Fig. 2.9</span></a>.</p>
<figure class="align-default" id="fig-nasa-api-limits">
<img alt="_images/NASA-API-limits.png" src="_images/NASA-API-limits.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.9 </span><span class="caption-text">The NASA website specifies an hourly limit of 1,000 requests.</span><a class="headerlink" href="#fig-nasa-api-limits" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>After checking the NASA website, it seems like we can send at most 1,000 requests per hour.
That should be more than enough for our purposes in this section.</p>
<section id="accessing-the-nasa-api">
<h4>Accessing the NASA API<a class="headerlink" href="#accessing-the-nasa-api" title="Permalink to this heading">#</a></h4>
<p id="index-63">The NASA API is what is known as an <em>HTTP API</em>: this is a particularly common
kind of API, where you can obtain data simply by accessing a
particular URL as if it were a regular website.  To make a query to the NASA
API, we need to specify three things.  First, we specify the URL <em>endpoint</em> of
the API, which is simply a URL that helps the remote server understand which
API you are trying to access. NASA offers a variety of APIs, each with its own
endpoint; in the case of the NASA “Astronomy Picture of the Day” API, the URL
endpoint is <code class="docutils literal notranslate"><span class="pre">https://api.nasa.gov/planetary/apod</span></code>. Second, we write <code class="docutils literal notranslate"><span class="pre">?</span></code>, which denotes that a
list of <em>query parameters</em> will follow. And finally, we specify a list of
query parameters of the form <code class="docutils literal notranslate"><span class="pre">parameter=value</span></code>, separated by <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> characters.  The NASA
“Astronomy Picture of the Day” API accepts the parameters shown in
<a class="reference internal" href="#fig-nasa-api-parameters"><span class="std std-numref">Fig. 2.10</span></a>.</p>
<figure class="align-default" id="fig-nasa-api-parameters">
<img alt="_images/NASA-API-parameters.png" src="_images/NASA-API-parameters.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.10 </span><span class="caption-text">The set of parameters that you can specify when querying the NASA “Astronomy Picture of the Day” API,
along with syntax, default settings, and a description of each.</span><a class="headerlink" href="#fig-nasa-api-parameters" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>So for example, to obtain the image of the day
from July 13, 2023, the API query would have two parameters: <code class="docutils literal notranslate"><span class="pre">api_key=YOUR_API_KEY</span></code>
and <code class="docutils literal notranslate"><span class="pre">date=2023-07-13</span></code>. Remember to replace <code class="docutils literal notranslate"><span class="pre">YOUR_API_KEY</span></code> with the API key you
received from NASA in your email! Putting it all together, the query will look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://api.nasa.gov/planetary/apod?api_key=YOUR_API_KEY&amp;date=2023-07-13
</pre></div>
</div>
<p>If you try putting this URL into your web browser, you’ll actually find that the server
responds to your request with some text:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;2023-07-13&quot;</span><span class="p">,</span><span class="nt">&quot;explanation&quot;</span><span class="p">:</span><span class="s2">&quot;A mere 390 light-years away, Sun-like stars</span>
<span class="s2">and future planetary systems are forming in the Rho Ophiuchi molecular cloud</span>
<span class="s2">complex, the closest star-forming region to our fair planet. The James Webb</span>
<span class="s2">Space Telescope&#39;s NIRCam peered into the nearby natal chaos to capture this</span>
<span class="s2">infrared image at an inspiring scale. The spectacular cosmic snapshot was</span>
<span class="s2">released to celebrate the successful first year of Webb&#39;s exploration of the</span>
<span class="s2">Universe. The frame spans less than a light-year across the Rho Ophiuchi region</span>
<span class="s2">and contains about 50 young stars. Brighter stars clearly sport Webb&#39;s</span>
<span class="s2">characteristic pattern of diffraction spikes. Huge jets of shocked molecular</span>
<span class="s2">hydrogen blasting from newborn stars are red in the image, with the large,</span>
<span class="s2">yellowish dusty cavity carved out by the energetic young star near its center.</span>
<span class="s2">Near some stars in the stunning image are shadows cast by their protoplanetary</span>
<span class="s2">disks.&quot;</span><span class="p">,</span><span class="nt">&quot;hdurl&quot;</span><span class="p">:</span><span class="s2">&quot;https://apod.nasa.gov/apod/image/2307/STScI-01_RhoOph.png&quot;</span><span class="p">,</span>
<span class="nt">&quot;media_type&quot;</span><span class="p">:</span><span class="s2">&quot;image&quot;</span><span class="p">,</span><span class="nt">&quot;service_version&quot;</span><span class="p">:</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Webb&#39;s</span>
<span class="s2">Rho Ophiuchi&quot;</span><span class="p">,</span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;https://apod.nasa.gov/apod/image/2307/STScI-01_RhoOph1024.png&quot;</span><span class="p">}</span>
</pre></div>
</div>
<span class="target" id="index-64"></span><p id="index-65">Neat! There is definitely some data there, but it’s a bit hard to
see what it all is. As it turns out, this is a common format for data called
<em>JSON</em> (JavaScript Object Notation). We won’t encounter this kind of data much in this book,
but for now you can interpret this data just like
you’d interpret a Python dictionary: these are <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">:</span> <span class="pre">value</span></code> pairs separated by
commas. For example, if you look closely, you’ll see that the first entry is
<code class="docutils literal notranslate"><span class="pre">&quot;date&quot;:&quot;2023-07-13&quot;</span></code>, which indicates that we indeed successfully received
data corresponding to July 13, 2023.</p>
<p>So now our job is to do all of this programmatically in Python. We will load
the <code class="docutils literal notranslate"><span class="pre">requests</span></code> package, and make the query using the <code class="docutils literal notranslate"><span class="pre">get</span></code> function, which takes a single URL argument;
you will recognize the same query URL that we pasted into the browser earlier.
We will then obtain a JSON representation of the
response using the <code class="docutils literal notranslate"><span class="pre">json</span></code> method.</p>
<!-- we have disabled the below code for reproducibility, with hidden setting
of the nasa_data object. But you can reproduce this using the DEMO_KEY key --><div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">nasa_data_single</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.nasa.gov/planetary/apod?api_key=YOUR_API_KEY&amp;date=2023-07-13&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">nasa_data_single</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;date&#39;: &#39;2023-07-13&#39;,
 &#39;explanation&#39;: &quot;A mere 390 light-years away, Sun-like stars and future planetary systems are forming in the Rho Ophiuchi molecular cloud complex, the closest star-forming region to our fair planet. The James Webb Space Telescope&#39;s NIRCam peered into the nearby natal chaos to capture this infrared image at an inspiring scale. The spectacular cosmic snapshot was released to celebrate the successful first year of Webb&#39;s exploration of the Universe. The frame spans less than a light-year across the Rho Ophiuchi region and contains about 50 young stars. Brighter stars clearly sport Webb&#39;s characteristic pattern of diffraction spikes. Huge jets of shocked molecular hydrogen blasting from newborn stars are red in the image, with the large, yellowish dusty cavity carved out by the energetic young star near its center. Near some stars in the stunning image are shadows cast by their protoplanetary disks.&quot;,
 &#39;hdurl&#39;: &#39;https://apod.nasa.gov/apod/image/2307/STScI-01_RhoOph.png&#39;,
 &#39;media_type&#39;: &#39;image&#39;,
 &#39;service_version&#39;: &#39;v1&#39;,
 &#39;title&#39;: &quot;Webb&#39;s Rho Ophiuchi&quot;,
 &#39;url&#39;: &#39;https://apod.nasa.gov/apod/image/2307/STScI-01_RhoOph1024.png&#39;}
</pre></div>
</div>
</div>
</div>
<p>We can obtain more records at once by using the <code class="docutils literal notranslate"><span class="pre">start_date</span></code> and <code class="docutils literal notranslate"><span class="pre">end_date</span></code> parameters, as
shown in the table of parameters in <a class="reference internal" href="#fig-nasa-api-parameters"><span class="std std-numref">Fig. 2.10</span></a>.
Let’s obtain all the records between May 1, 2023, and July 13, 2023, and store the result
in an object called <code class="docutils literal notranslate"><span class="pre">nasa_data</span></code>; now the response
will take the form of a Python list. Each item in the list will correspond to a single day’s record (just like the <code class="docutils literal notranslate"><span class="pre">nasa_data_single</span></code> object),
and there will be 74 items total, one for each day between the start and end dates:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nasa_data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.nasa.gov/planetary/apod?api_key=YOUR_API_KEY&amp;start_date=2023-05-01&amp;end_date=2023-07-13&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">nasa_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>74
</pre></div>
</div>
</div>
</div>
<p>For further data processing using the techniques in this book, you’ll need to turn this list of dictionaries
into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame. Here we will extract the <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">title</span></code>, <code class="docutils literal notranslate"><span class="pre">copyright</span></code>, and <code class="docutils literal notranslate"><span class="pre">url</span></code> variables
from the JSON data, and construct a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame using the extracted information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Understanding this code is not required for the remainder of the textbook. It is included for those
readers who would like to parse JSON data into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame in their own data analyses.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:[],</span>
    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;copyright&quot;</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nasa_data</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;copyright&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
        <span class="n">item</span><span class="p">[</span><span class="s2">&quot;copyright&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;copyright&quot;</span><span class="p">]:</span>
        <span class="n">data_dict</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

<span class="n">nasa_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
<span class="n">nasa_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>title</th>
      <th>copyright</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-05-01</td>
      <td>Carina Nebula North</td>
      <td>\nCarlos Taylor\n</td>
      <td>https://apod.nasa.gov/apod/image/2305/CarNorth...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-05-02</td>
      <td>Flat Rock Hills on Mars</td>
      <td>\nNASA, \nJPL-Caltech, \nMSSS;\nProcessing: Ne...</td>
      <td>https://apod.nasa.gov/apod/image/2305/FlatMars...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-05-03</td>
      <td>Centaurus A: A Peculiar Island of Stars</td>
      <td>\nMarco Lorenzi,\nAngus Lau &amp; Tommy Tse; \nTex...</td>
      <td>https://apod.nasa.gov/apod/image/2305/NGC5128_...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-05-04</td>
      <td>The Galaxy, the Jet, and a Famous Black Hole</td>
      <td>None</td>
      <td>https://apod.nasa.gov/apod/image/2305/pia23122...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-05-05</td>
      <td>Shackleton from ShadowCam</td>
      <td>None</td>
      <td>https://apod.nasa.gov/apod/image/2305/shacklet...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69</th>
      <td>2023-07-09</td>
      <td>Doomed Star Eta Carinae</td>
      <td>\nNASA, \nESA, \nHubble;\n Processing &amp; \nLice...</td>
      <td>https://apod.nasa.gov/apod/image/2307/EtaCarin...</td>
    </tr>
    <tr>
      <th>70</th>
      <td>2023-07-10</td>
      <td>Stars, Dust and Nebula in NGC 6559</td>
      <td>\nAdam Block,\nTelescope Live\n</td>
      <td>https://apod.nasa.gov/apod/image/2307/NGC6559_...</td>
    </tr>
    <tr>
      <th>71</th>
      <td>2023-07-11</td>
      <td>Sunspots on an Active Sun</td>
      <td>None</td>
      <td>https://apod.nasa.gov/apod/image/2307/SpottedS...</td>
    </tr>
    <tr>
      <th>72</th>
      <td>2023-07-12</td>
      <td>Rings and Bar of Spiral Galaxy NGC 1398</td>
      <td>None</td>
      <td>https://apod.nasa.gov/apod/image/2307/Ngc1398_...</td>
    </tr>
    <tr>
      <th>73</th>
      <td>2023-07-13</td>
      <td>Webb's Rho Ophiuchi</td>
      <td>None</td>
      <td>https://apod.nasa.gov/apod/image/2307/STScI-01...</td>
    </tr>
  </tbody>
</table>
<p>74 rows × 4 columns</p>
</div></div></div>
</div>
<p>Success—we have created a small data set using the NASA
API! This data is also quite different from what we obtained from web scraping;
the extracted information is readily available in a JSON format, as opposed to raw
HTML code (although not <em>every</em> API will provide data in such a nice format).
From this point onward, the <code class="docutils literal notranslate"><span class="pre">nasa_df</span></code> data frame is stored on your
machine, and you can play with it to your heart’s content. For example, you can use
<code class="docutils literal notranslate"><span class="pre">pandas.to_csv</span></code> to save it to a file and <code class="docutils literal notranslate"><span class="pre">pandas.read_csv</span></code> to read it into Python again later;
and after reading the next few chapters you will have the skills to
do even more interesting things! If you decide that you want
to ask any of the various NASA APIs for more data
(see <a class="reference external" href="https://api.nasa.gov/">the list of awesome NASA APIS here</a>
for more examples of what is possible), just be mindful as usual about how much
data you are requesting and how frequently you are making requests.</p>
</section>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">2.9. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p>Practice exercises for the material covered in this chapter can be found in the
accompanying <a class="reference external" href="https://worksheets.python.datasciencebook.ca">worksheets repository</a> in
the “Reading in data locally and from the web” row. You can preview a
non-interactive version of the worksheet for this chapter by clicking “view
worksheet.” To work on the exercises interactively, follow the instructions in
the worksheets repository to download all worksheets, and follow the
instructions for computer setup found in <a class="reference internal" href="setup.html#move-to-your-own-machine"><span class="std std-numref">Chapter 13</span></a>. This will ensure
that the automated feedback and guidance that the worksheets provide will
function as intended.</p>
</section>
<section id="additional-resources">
<h2><span class="section-number">2.10. </span>Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The <a class="reference external" href="https://pandas.pydata.org/docs/getting_started/index.html"><code class="docutils literal notranslate"><span class="pre">pandas</span></code> documentation</a>
provides the documentation for the functions we cover in this chapter.
It is where you should look if you want to learn more about these functions, the
full set of arguments you can use, and other related functions.</p></li>
<li><p>Sometimes you might run into data in such poor shape that the reading
functions we cover in this chapter do not work. In that case, you can consult the
<a class="reference external" href="https://wesmckinney.com/book/accessing-data.html#io_flat_files">data loading chapter</a>
from <a class="reference external" href="https://wesmckinney.com/book/"><em>Python for Data Analysis</em></a> <span id="id5">[<a class="reference internal" href="wrangling.html#id52" title="Wes McKinney. Python for data analysis: Data wrangling with Pandas, NumPy, and IPython. &quot; O'Reilly Media, Inc.&quot;, 2012.">McKinney, 2012</a>]</span>, which goes into a lot
more detail about how Python parses text from files into data frames.</p></li>
<li><p>A <a class="reference external" href="https://www.youtube.com/embed/ephId3mYu9o">video</a> from the Udacity
course <em>Linux Command Line Basics</em> provides a good explanation of absolute versus relative paths.</p></li>
<li><p>If you read the subsection on obtaining data from the web via scraping and
APIs, we provide two companion tutorial video links for how to use the
SelectorGadget tool to obtain desired CSS selectors for:</p>
<ul>
<li><p><a class="reference external" href="https://www.youtube.com/embed/YdIWI6K64zo">extracting the data for apartment listings on Craigslist</a>, and</p></li>
<li><p><a class="reference external" href="https://www.youtube.com/embed/O9HKbdhqYzk">extracting Canadian city names and populations from Wikipedia</a>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="references">
<h2><span class="section-number">2.11. </span>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<div class="docutils container" id="id6">
<dl class="citation">
<dt class="label" id="id54"><span class="brackets"><a class="fn-backref" href="#id5">McK12</a></span></dt>
<dd><p>Wes McKinney. <em>Python for data analysis: Data wrangling with Pandas, NumPy, and IPython</em>. &quot; O'Reilly Media, Inc.&quot;, 2012.</p>
</dd>
<dt class="label" id="id71"><span class="brackets"><a class="fn-backref" href="#id3">RThePSFoundation23</a></span></dt>
<dd><p>Kenneth Reitz and The Python Software Foundation. Requests: http for humans. <em>URL: https://requests.readthedocs.io/en/latest/</em>, Accessed Online: 2023.</p>
</dd>
<dt class="label" id="id70"><span class="brackets"><a class="fn-backref" href="#id2">Ric07</a></span></dt>
<dd><p>Leonard Richardson. Beautiful soup documentation. <em>April</em>, 2007.</p>
</dd>
<dt class="label" id="id72"><span class="brackets"><a class="fn-backref" href="#id4">NASAESACSA+23</a></span></dt>
<dd><p>NASA, ESA, CSA, STScI, K. Pontoppidan (STScI), and A. Pagan (STScI). Rho ophiuchi cloud complex. <em>URL: https://esawebb.org/images/weic2316a/</em>, Accessed Online: 2023.</p>
</dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id1">RealTSProject21</a></span></dt>
<dd><p>Real Time Statistics Project. Internet live stats: google search statistics. 2021. URL: <a class="reference external" href="https://www.internetlivestats.com/google-search-statistics/">https://www.internetlivestats.com/google-search-statistics/</a>.</p>
</dd>
</dl>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Python and Pandas</p>
      </div>
    </a>
    <a class="right-next"
       href="wrangling.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Cleaning and wrangling data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">2.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-learning-objectives">2.2. Chapter learning objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-and-relative-file-paths">2.3. Absolute and relative file paths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-tabular-data-from-a-plain-text-file-into-python">2.4. Reading tabular data from a plain text file into Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-csv-to-read-in-comma-separated-values-files">2.4.1. <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to read in comma-separated values files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#skipping-rows-when-reading-in-data">2.4.2. Skipping rows when reading in data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-sep-argument-for-different-separators">2.4.3. Using the <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument for different separators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-header-argument-to-handle-missing-column-names">2.4.4. Using the <code class="docutils literal notranslate"><span class="pre">header</span></code> argument to handle missing column names</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-tabular-data-directly-from-a-url">2.4.5. Reading tabular data directly from a URL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#previewing-a-data-file-before-reading-it-into-python">2.4.6. Previewing a data file before reading it into Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-tabular-data-from-a-microsoft-excel-file">2.5. Reading tabular data from a Microsoft Excel file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-a-database">2.6. Reading data from a database</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-a-sqlite-database">2.6.1. Reading data from a SQLite database</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-a-postgresql-database">2.6.2. Reading data from a PostgreSQL database</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-should-we-bother-with-databases-at-all">2.6.3. Why should we bother with databases at all?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-data-from-python-to-a-csv-file">2.7. Writing data from Python to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-data-from-the-web">2.8. Obtaining data from the web</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#web-scraping">2.8.1. Web scraping</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#html-and-css-selectors">HTML and CSS selectors</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scraping-with-beautifulsoup">Scraping with <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scraping-with-read-html">Scraping with <code class="docutils literal notranslate"><span class="pre">read_html</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-an-api">2.8.2. Using an API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-nasa-api">Accessing the NASA API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">2.9. Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">2.10. Additional resources</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">2.11. References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tiffany Timbers, Trevor Campbell, Melissa Lee, Joel Ostblom, and Lindsey Heagy
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>